# 现代信息技术概览——实验报告

**JL19060001-侯天铭**

**JL19060002-李秋宇**

------

<u>下面首先是关于范例的介绍：</u>

首先对用到的端口做一个声明：

- I6：左侧红外对管；
- I7：右侧红外对管；
- M1：左侧电机；
- M3：右侧电机；
- O8：喇叭。

其中I6，I7若对着黑线，返回0；若处于黑线外，则返回1。

后续若有修改或补充，则在相应模块中进行说明。

------



## 一、寻迹小车

### 1、完成的功能：

小车循黑线行驶：若小车偏离轨迹（黑线），可在一定范围内自动行驶并寻找黑线，找到则回到轨迹上继续行驶；反之，判断无轨迹，停止运行，并鸣笛3声。

### 2、实现方法：

**主程序：**

![image-20201014231501859](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201014231501859.png)

若I6，I7均为0，即小车此时刚好处在黑线上方，故直行即可，也就是设置M1，M3输出6V（1V-8V的输出可以用来控制电机转速）；若I6=1，I7=0，说明小车左侧出黑线，则需要右转，故首先让两电机停止，然后只动M1即左轮，实现右转；若I6=0，I7=1，说明小车右侧出黑线，此时左转（M3输出）即可；最后，如果I6，I7均为1，说明小车完全不在黑线上，那么此时会调用track-seeking算法来寻找黑线。

**track-seeking：**

![image-20201014232105087](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201014232105087.png)

进入子程序，进行10轮循环。整体效果为，小车先旋转，然后直行，同时判断I6，I7的值，如果在这个过程中的某时刻I6，I7已经同时为0，说明已经回到黑线上，则直接停车由Trail退出，此时回到主程序继续循迹；然而如果经过10轮循环后还没有找到黑线上，则由end退出，此时回到主程序调用Horn，然后整个程序结束。

**Horn：**

![image-20201014232653743](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201014232653743.png)

就是完成鸣笛的功能，没什么需要解释的。



## 二、颜色识别

### 1、完成的功能：

在行驶过程中通过传感器识别红色、绿色、蓝色色块，在相应色块处暂时停住并鸣笛且点亮相应颜色的灯泡.。(每种色块只识别一次,只执行上述操作一次。例:有两块红色色块在路径上，小车只识别第一次经过的色块并执行上述操作）

当识别完三种色块（rgb）后小车停止。

### 2、实现方法：

- O7：红灯；
- O3：绿灯；
- O4：蓝灯。
- I4：颜色传感器。给出当前识别到的颜色数值，于是只要知道red,green,blue三者对应的数值范围即可完成颜色的识别与判断。至于三种颜色的数值范围则可以让小车从色块上跑过，根据数值的变化取一个大致的区间。

**主程序：**

![image-20201014232938976](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201014232938976.png)

就具体算法而言，首先是给M1,M3信号，让小车前进，然后对A的值进行判断（这个在后面还会提到），一开始A肯定不是1，故进入下面的循环之中，判断颜色数值是否在red的范围内，如果在（如果不在，则继续前进进行下一个颜色的判断），则车停，并给red对应的A赋值1（这就保证了只会判断一次red，对green,blue也是同理。也就是说再次经过同一颜色的色块不会再次停车），然后是点亮对应的灯，鸣笛，关灯，停止鸣笛。小车会持续前进直到三种颜色各识别一次（此时三个A均为1，故and的结果为1），停车结束。



## 三、探索者

### 1、完成的功能：

- 小车循迹、避障：小车循黑线行驶：若小车偏离轨迹（黑线），可在一定范围内自动行驶并寻找黑线，找到则回到轨迹上继续行驶；反之，判断无轨迹，停止运行，并鸣笛3声。同时，若小车距离前方障碍物过近，则会采取后退，旋转朝另一个方向前进的策略；


- 亮度采集：通过光敏电阻采集环境光强度（光强越弱，数值越高），并设定阈值，超过阈值点亮LED灯1；反之熄灭LED灯1；


- 温度采集：通过热敏电阻采集环境温度强度(通过公式转换)，并设定阈值，超过阈值点亮LED灯；反之熄灭LED灯；


- 颜色识别：在沿着轨迹行驶的同时，识别红色、绿色、蓝色色块，并鸣笛示意。


### 2、实现方法：

- I7：左侧红外对管；

- I8：右侧红外对管；

- I3：距离传感器；

- I4：颜色传感器；

- I5：光敏电阻；

- I6：热敏电阻；

- O3：灯；

- O4：灯；

- O7：灯。

  

**主程序：**

![image-20201015084751639](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201015084751639.png)

正如上面说过的，该程序需要完成4种不同的功能，于是可以看到该程序中具有4个不同的线程，分别说明如下：

1. 循迹、避障：首先调用track-seeking，若小车最终无法回到黑线上，则鸣笛停车结束；若回到黑线上，则是与前面相同的一个循迹算法，只不过在循迹过程中加入了Obstacle子程序，实现避障功能；
2. 亮度采集：调用Light；
3. 温度采集：调用temperature；
4. 颜色识别：调用color identification。（先判断A的值然后再进行颜色识别实现的功能在下面会讲到）

**track-seeking：**

![image-20201015085813161](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201015085813161.png)

大体与前面的算法一致，只不过在寻找黑线的过程中加入了Obstacle。另外，在进入track-seeking时给Trail赋值1，此时不会进行颜色判断，只有当成功回到黑线上时，即从Trail回到主程序时，才会给Trail赋值0，从而开始进行颜色识别。故颜色识别只发生在循黑线移动的过程中。

Horn不再赘述。

**Obstacle：**

![image-20201015090439234](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201015090439234.png)

I3输入的值为前方障碍物的距离，若距离过近（I3<10），则停止，后退，直到I3>11，再次停车，然后旋转到另一个方向停下来退出该程序。当然如果前方障碍物距离还很远，则直接从NO退出。退出该程序之后继续回到主程序循迹。

**Light：**

![image-20201015091040254](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201015091040254.png)

I5反映了当前光强（光强越弱，数值越大），故设定阈值（此处使用600并没有什么特殊的含义），若I5>600，说明光强较弱，此时打开灯光，反之关闭灯光。

**temperature：**

![image-20201015091519417](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201015091519417.png)

I6给出当前环境温度对应的数值（并不是实际温度），然后将该数值传入NTC->T，NTC->T如下所示：

![image-20201015091609983](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201015091609983.png)

其是依据公式![image-20201015091621100](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201015091621100.png)

计算出当前的实际温度T。T输出之后与28进行比较，若小于28，则亮一次灯，反之不做操作。

**color identification：**

![image-20201015092328183](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201015092328183.png)

整个判断过程与前面介绍的大致相同，只不过现在是识别到了一个颜色或red,green,blue三者都没识别到，均会退出程序，然后由于main里面的循环再次进入该程序进行识别。

------



<u>以下是创新模型的功能与实现方法</u>



# **追光小车**

## 一、模型实现的功能与设计思路

### 1、功能：

实现小车对前方移动光源的同步移动跟随功能(光源不移动亦可)，并在距离光源足够近时停止。在环境光强度分布均匀的情况下，小车也停止运行。

### 2、设计思路：

- I5：右侧光敏电阻；
- I1：左侧光敏电阻。

之所以想到做一个寻光小车，纯粹是因为范例里面有一个循迹小车，稍微改变一下思路就有了这个结果。

我们利用两个光敏电阻，分别置于小车两侧，测量两侧的光强。前面已经提到过，光强越强的地方，返回的数值越低，那么只需朝着数值低的那一侧移动即可。

除此之外，需要考虑到器件的差异性，即在环境光强度分布均匀的情况下，由于器件返回的值不可能完全相同，但此时可认为光强处处相等，小车不应该移动，故设置了一个阈值，即在两侧光强差不大于这个值的时候，认为两侧光强相同，小车不动。

最后就是令小车距离光源足够近时停下来。



## 二、整体与局部图片

<img src="C:\Users\91996\Documents\Tencent Files\919969128\FileRecv\MobileFile\IMG_20201015_094918.jpg" alt="IMG_20201015_094918"  />

![IMG_20201015_094939](C:\Users\91996\Documents\Tencent Files\919969128\FileRecv\MobileFile\IMG_20201015_094939.jpg)

![IMG20201010193058](C:\Users\91996\Documents\Tencent Files\919969128\FileRecv\MobileFile\IMG20201010193058.jpg)

![IMG20201010193104](C:\Users\91996\Documents\Tencent Files\919969128\FileRecv\MobileFile\IMG20201010193104.jpg)



## 三、主程序流程图

（只有一个主程序，没有子程序）

![image-20201015095156025](C:\Users\91996\AppData\Roaming\Typora\typora-user-images\image-20201015095156025.png)

程序很简单，I5、I1为两个光敏电阻返回的值，两个作差的结果取绝对值与10进行比较，若小于10，则我们认为两侧光强相等，小车静止不动。若不小于10，则进入下一步判断，这里将A=I5-I1的结果与0进行比较，若A<0，说明右侧光强更强，则向右旋转1ms，反之向左旋转1ms，然后直行5ms。（延迟时间是在反复测试的情况下得出的一个使小车能够比较平稳的行驶的值）接着，需要再次判断一下两侧的光强，只要其中之一<=300，我们认为小车已经足够接近光源了，于是停车结束。否则的话又回到开头继续寻光行驶。



## 四、模型演示完整视频

